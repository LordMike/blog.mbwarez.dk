<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PDF Search Site | Thoughts, stories and ideas</title>
<meta name=keywords content="C#,.NET,Projects,Utilities"><meta name=description content="An Introduction
So, I’m moving into an apartment in the near future. Following that, I will have to learn how to manage my documents and ensure I can find them back in time. I’ve thought of a few solutions, one of them being what I do now – where I simply have a folder with PDFs of my documents (I digitalize everything). This works fine now&mldr; (I have like … 20 documents)&mldr; But it may not work in 2 years when I have a hundred documents spread over many different corporations and years."><meta name=author content="Michael Bisbjerg"><link rel=canonical href=https://blog.mbwarez.dk/posts/2010/pdf-search-site/><link crossorigin=anonymous href=/assets/css/stylesheet.36ab24e4c1b924360adfc391166b0e8914323d9d6ffa42a50f9c6c435c5e1831.css integrity="sha256-Nqsk5MG5JDYK38ORFmsOiRQyPZ1v+kKlD5xsQ1xeGDE=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.mbwarez.dk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.mbwarez.dk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mbwarez.dk/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.mbwarez.dk/apple-touch-icon.png><link rel=mask-icon href=https://blog.mbwarez.dk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.mbwarez.dk/posts/2010/pdf-search-site/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.mbwarez.dk/posts/2010/pdf-search-site/"><meta property="og:site_name" content="Thoughts, stories and ideas"><meta property="og:title" content="PDF Search Site"><meta property="og:description" content="An Introduction So, I’m moving into an apartment in the near future. Following that, I will have to learn how to manage my documents and ensure I can find them back in time. I’ve thought of a few solutions, one of them being what I do now – where I simply have a folder with PDFs of my documents (I digitalize everything). This works fine now… (I have like … 20 documents)… But it may not work in 2 years when I have a hundred documents spread over many different corporations and years."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-08-10T00:00:00+00:00"><meta property="article:modified_time" content="2010-08-10T00:00:00+00:00"><meta property="article:tag" content="C#"><meta property="article:tag" content=".NET"><meta property="article:tag" content="Projects"><meta property="article:tag" content="Utilities"><meta property="og:image" content="https://blog.mbwarez.dk/assets/images/cover.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.mbwarez.dk/assets/images/cover.jpg"><meta name=twitter:title content="PDF Search Site"><meta name=twitter:description content="An Introduction
So, I’m moving into an apartment in the near future. Following that, I will have to learn how to manage my documents and ensure I can find them back in time. I’ve thought of a few solutions, one of them being what I do now – where I simply have a folder with PDFs of my documents (I digitalize everything). This works fine now&mldr; (I have like … 20 documents)&mldr; But it may not work in 2 years when I have a hundred documents spread over many different corporations and years."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.mbwarez.dk/posts/"},{"@type":"ListItem","position":2,"name":"PDF Search Site","item":"https://blog.mbwarez.dk/posts/2010/pdf-search-site/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PDF Search Site","name":"PDF Search Site","description":"An Introduction So, I’m moving into an apartment in the near future. Following that, I will have to learn how to manage my documents and ensure I can find them back in time. I’ve thought of a few solutions, one of them being what I do now – where I simply have a folder with PDFs of my documents (I digitalize everything). This works fine now\u0026hellip; (I have like … 20 documents)\u0026hellip; But it may not work in 2 years when I have a hundred documents spread over many different corporations and years.\n","keywords":["C#",".NET","Projects","Utilities"],"articleBody":"An Introduction So, I’m moving into an apartment in the near future. Following that, I will have to learn how to manage my documents and ensure I can find them back in time. I’ve thought of a few solutions, one of them being what I do now – where I simply have a folder with PDFs of my documents (I digitalize everything). This works fine now… (I have like … 20 documents)… But it may not work in 2 years when I have a hundred documents spread over many different corporations and years.\nI then thought of making the system searchable. This means I need a method of indexing all documents, preferably long-term. I thought of making a website, where I attach metadata to each uploaded document (that I make searchable by using OCR). Metadata will include things like the start and end date, a descriptive title, and perhaps one or two categories.\nThe idea is to archive all documents and bills from cable, ISP, heating, electricity, etc., with their validity dates. When I search for a given date, I want to see all documents that cover that date and match those criteria (for example, “Electricity”).\nUsing a system like this, it’d be easy to go back in time and view bills from a provider at a given date—without pulling down a 4 KG Ring Binder full of mixed pages.\nBackground Tools I, of course, would want to code this in C#, preferably as a web application. I’ll need a method to extract text from PDF documents (headings, tables, regular text) for indexing purposes.\nFor reading PDFs in C#, I found this blog post about PDFBox. It’s originally a Java library but can be used in C#. After testing, I found that PDFBox doesn’t handle most of my OCR-scanned PDFs.\nA Stack Overflow article confirmed this problem. The first post recommends PDFTextStream, which works well but isn’t free.\nBack to square one, I found PdfToText, a simple command-line tool available here. It outputs exactly what I need—for free!\nThe plan is to use this utility in the application. It exports a text file that the app can read.\nThe Database The database is an important part. I plan to have tables for:\nUsers: Security is important. Documents: The core of the product. Categories: To assist with sorting. Initially, I won’t store files in the DB—just text for search. I’ll store filename, hash (SHA1), upload date, and the extracted text. The hash maps to the physical file.\nEach document also gets a date range (datefrom, dateto). If dateto is empty, only datefrom is relevant.\nThe Website I’ll code the site in C#. This time, I’m using LINQ. It allows direct queries on my database in code (not using ADO.Net). Really handy for fast development.\nI’m also using .ashx handlers to provide downloads without exposing file locations. This lets me use the app_data folder securely.\nKey features:\nPDF extraction Private security considerations Document encryption Searching algorithm Download page PDF Extraction I settled on Xpdf for extracting text.\nprivate void PDFToText(string tempName, out string error, out string text) { string path_exe = Server.MapPath(\"~/app_data/temp/pdftotext.exe\"); string path_pdf = Server.MapPath(\"~/app_data/temp/\" + tempName); string path_txt = Server.MapPath(\"~/app_data/temp/\" + tempName + \".txt\"); var pstart = new System.Diagnostics.ProcessStartInfo { FileName = path_exe, Arguments = $\"\\\"{path_pdf}\\\" \\\"{path_txt}\\\"\", UseShellExecute = false, RedirectStandardOutput = false, RedirectStandardError = true, CreateNoWindow = true }; var p = new System.Diagnostics.Process { StartInfo = pstart }; p.Start(); p.WaitForExit(); text = File.Exists(path_txt) ? File.ReadAllText(path_txt) : \"\"; if (File.Exists(path_txt)) File.Delete(path_txt); error = p.StandardError.ReadToEnd(); } Considerations of Private Security Some files contain personal data (e.g., Danish CPR numbers). I created a regex to remove patterns like xxxxxx-xxxx, replacing them with {CPR REMOVED}.\nEncryption of Documents I encrypt uploaded files using the user’s password and TripleDES, using this wrapper.\nIf a user changes their password, all documents are re-encrypted. A dencrypthash field tracks which password was used. Not the most secure system—more “security by obscurity”—but sufficient for my use.\nSearching Algorithm This is my proudest part. I used to build huge SQL queries. With LINQ, I build object-based filters.\nI:\nFilter by categories (inclusion/exclusion) Filter by date ranges Extract full-text content Use splitters to tokenize text Search by name/content/tags using different matching methods (Begins With, Ends With, AND, OR) Despite being a bit slow (½–1s per search), it’s flexible and understandable.\nDownload Page I use .ashx handlers to control downloads securely. The app_data folder is perfect since IIS blocks direct access.\nHandlers check session login and document ownership. Then they decrypt the file if necessary and stream it back to the user.\nConclusion This project taught me a lot about LINQ, secure file storage with app_data, and practical encryption. I now have a working document archive system that I use personally.\nThe site is live with 23 MB of PDFs and growing.\nI’m as happy with this as I was with Mobifinance. The DocsArchive site was previously available here (link may be broken).\n","wordCount":"823","inLanguage":"en","image":"https://blog.mbwarez.dk/assets/images/cover.jpg","datePublished":"2010-08-10T00:00:00Z","dateModified":"2010-08-10T00:00:00Z","author":{"@type":"Person","name":"Michael Bisbjerg"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.mbwarez.dk/posts/2010/pdf-search-site/"},"publisher":{"@type":"Organization","name":"Thoughts, stories and ideas","logo":{"@type":"ImageObject","url":"https://blog.mbwarez.dk/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.mbwarez.dk/ accesskey=h title="Thoughts, stories and ideas (Alt + H)">Thoughts, stories and ideas</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.mbwarez.dk/archives title="All posts"><span>All posts</span></a></li><li><a href=https://blog.mbwarez.dk/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.mbwarez.dk/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://github.com/LordMike/ title=Github><span><i class="fa fa-question"></i>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/michael-bisbjerg/ title=LinkedIn><span>LinkedIn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.mbwarez.dk/>Home</a>&nbsp;»&nbsp;<a href=https://blog.mbwarez.dk/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">PDF Search Site</h1><div class=post-meta><span title='2010-08-10 00:00:00 +0000 UTC'>August 10, 2010</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Michael Bisbjerg</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#an-introduction aria-label="An Introduction">An Introduction</a><ul><li><a href=#background-tools aria-label="Background Tools">Background Tools</a></li><li><a href=#the-database aria-label="The Database">The Database</a></li><li><a href=#the-website aria-label="The Website">The Website</a></li><li><a href=#pdf-extraction aria-label="PDF Extraction">PDF Extraction</a></li><li><a href=#considerations-of-private-security aria-label="Considerations of Private Security">Considerations of Private Security</a></li><li><a href=#encryption-of-documents aria-label="Encryption of Documents">Encryption of Documents</a></li><li><a href=#searching-algorithm aria-label="Searching Algorithm">Searching Algorithm</a></li><li><a href=#download-page aria-label="Download Page">Download Page</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=an-introduction>An Introduction<a hidden class=anchor aria-hidden=true href=#an-introduction>#</a></h1><p>So, I’m moving into an apartment in the near future. Following that, I will have to learn how to manage my documents and ensure I can find them back in time. I’ve thought of a few solutions, one of them being what I do now – where I simply have a folder with PDFs of my documents (I digitalize everything). This works fine now&mldr; (I have like … 20 documents)&mldr; But it may not work in 2 years when I have a hundred documents spread over many different corporations and years.</p><p>I then thought of making the system searchable. This means I need a method of indexing all documents, preferably long-term. I thought of making a website, where I attach metadata to each uploaded document (that I make searchable by using <a href=http://en.wikipedia.org/wiki/Optical_character_recognition>OCR</a>). Metadata will include things like the start and end date, a descriptive title, and perhaps one or two categories.</p><p>The idea is to archive all documents and bills from cable, ISP, heating, electricity, etc., with their validity dates. When I search for a given date, I want to see all documents that cover that date and match those criteria (for example, “Electricity”).</p><p>Using a system like this, it’d be easy to go back in time and view bills from a provider at a given date—without pulling down a 4 KG <a href=http://en.wikipedia.org/wiki/Ring_binder>Ring Binder</a> full of mixed pages.</p><h2 id=background-tools>Background Tools<a hidden class=anchor aria-hidden=true href=#background-tools>#</a></h2><p>I, of course, would want to code this in C#, preferably as a web application. I’ll need a method to extract text from PDF documents (headings, tables, regular text) for indexing purposes.</p><p>For reading PDFs in C#, I found <a href=http://studentclub.ro/lucians_weblog/archive/2007/03/22/read-from-a-pdf-file-using-c.aspx>this blog post</a> about <a href=http://www.pdfbox.org/>PDFBox</a>. It’s originally a Java library but can be used in C#. After testing, I found that PDFBox doesn’t handle most of my OCR-scanned PDFs.</p><p>A <a href=http://stackoverflow.com/questions/778145/pdf-text-extraction-approach-using-ocr>Stack Overflow article</a> confirmed this problem. The first post recommends <a href=http://snowtide.com/PDFTextStream>PDFTextStream</a>, which works well but isn’t free.</p><p>Back to square one, I found <a href=http://www.foolabs.com/xpdf/about.html>PdfToText</a>, a simple command-line tool available <a href=http://www.foolabs.com/xpdf/download.html>here</a>. It outputs exactly what I need—for free!</p><p>The plan is to use this utility in the application. It exports a text file that the app can read.</p><h2 id=the-database>The Database<a hidden class=anchor aria-hidden=true href=#the-database>#</a></h2><p>The database is an important part. I plan to have tables for:</p><ul><li><strong>Users</strong>: Security is important.</li><li><strong>Documents</strong>: The core of the product.</li><li><strong>Categories</strong>: To assist with sorting.</li></ul><p>Initially, I won’t store files in the DB—just text for search. I’ll store filename, hash (SHA1), upload date, and the extracted text. The hash maps to the physical file.</p><p>Each document also gets a date range (<code>datefrom</code>, <code>dateto</code>). If <code>dateto</code> is empty, only <code>datefrom</code> is relevant.</p><h2 id=the-website>The Website<a hidden class=anchor aria-hidden=true href=#the-website>#</a></h2><p>I’ll code the site in C#. This time, I’m using LINQ. It allows direct queries on my database in code (not using ADO.Net). Really handy for fast development.</p><p>I’m also using <a href=http://dotnetperls.com/ashx-handler>.ashx handlers</a> to provide downloads without exposing file locations. This lets me use the <code>app_data</code> folder securely.</p><p>Key features:</p><ul><li>PDF extraction</li><li>Private security considerations</li><li>Document encryption</li><li>Searching algorithm</li><li>Download page</li></ul><h2 id=pdf-extraction>PDF Extraction<a hidden class=anchor aria-hidden=true href=#pdf-extraction>#</a></h2><p>I settled on <a href=http://www.foolabs.com/xpdf/home.html>Xpdf</a> for extracting text.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=k>void</span> <span class=n>PDFToText</span><span class=p>(</span><span class=kt>string</span> <span class=n>tempName</span><span class=p>,</span> <span class=k>out</span> <span class=kt>string</span> <span class=n>error</span><span class=p>,</span> <span class=k>out</span> <span class=kt>string</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>path_exe</span> <span class=p>=</span> <span class=n>Server</span><span class=p>.</span><span class=n>MapPath</span><span class=p>(</span><span class=s>&#34;~/app_data/temp/pdftotext.exe&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>path_pdf</span> <span class=p>=</span> <span class=n>Server</span><span class=p>.</span><span class=n>MapPath</span><span class=p>(</span><span class=s>&#34;~/app_data/temp/&#34;</span> <span class=p>+</span> <span class=n>tempName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>path_txt</span> <span class=p>=</span> <span class=n>Server</span><span class=p>.</span><span class=n>MapPath</span><span class=p>(</span><span class=s>&#34;~/app_data/temp/&#34;</span> <span class=p>+</span> <span class=n>tempName</span> <span class=p>+</span> <span class=s>&#34;.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>pstart</span> <span class=p>=</span> <span class=k>new</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>ProcessStartInfo</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FileName</span> <span class=p>=</span> <span class=n>path_exe</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>Arguments</span> <span class=p>=</span> <span class=s>$&#34;\&#34;</span><span class=p>{</span><span class=n>path_pdf</span><span class=p>}</span><span class=err>\</span><span class=s>&#34; \&#34;{path_txt}\&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>UseShellExecute</span> <span class=p>=</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>RedirectStandardOutput</span> <span class=p>=</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>RedirectStandardError</span> <span class=p>=</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>CreateNoWindow</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>p</span> <span class=p>=</span> <span class=k>new</span> <span class=n>System</span><span class=p>.</span><span class=n>Diagnostics</span><span class=p>.</span><span class=n>Process</span> <span class=p>{</span> <span class=n>StartInfo</span> <span class=p>=</span> <span class=n>pstart</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=n>Start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=n>WaitForExit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>text</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>Exists</span><span class=p>(</span><span class=n>path_txt</span><span class=p>)</span> <span class=p>?</span> <span class=n>File</span><span class=p>.</span><span class=n>ReadAllText</span><span class=p>(</span><span class=n>path_txt</span><span class=p>)</span> <span class=p>:</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>File</span><span class=p>.</span><span class=n>Exists</span><span class=p>(</span><span class=n>path_txt</span><span class=p>))</span> <span class=n>File</span><span class=p>.</span><span class=n>Delete</span><span class=p>(</span><span class=n>path_txt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>error</span> <span class=p>=</span> <span class=n>p</span><span class=p>.</span><span class=n>StandardError</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=considerations-of-private-security>Considerations of Private Security<a hidden class=anchor aria-hidden=true href=#considerations-of-private-security>#</a></h2><p>Some files contain personal data (e.g., Danish <a href=http://en.wikipedia.org/wiki/Personal_identification_number_%28Denmark%29>CPR</a> numbers). I created a regex to remove patterns like <code>xxxxxx-xxxx</code>, replacing them with <code>{CPR REMOVED}</code>.</p><h2 id=encryption-of-documents>Encryption of Documents<a hidden class=anchor aria-hidden=true href=#encryption-of-documents>#</a></h2><p>I encrypt uploaded files using the user’s password and TripleDES, using <a href=http://www.geekzilla.co.uk/view7B360BD8-A77C-4F1F-BCA0-ACD0F6795F61.htm>this wrapper</a>.</p><p>If a user changes their password, all documents are re-encrypted. A <code>dencrypthash</code> field tracks which password was used. Not the most secure system—more “security by obscurity”—but sufficient for my use.</p><h2 id=searching-algorithm>Searching Algorithm<a hidden class=anchor aria-hidden=true href=#searching-algorithm>#</a></h2><p>This is my proudest part. I used to build huge SQL queries. With LINQ, I build object-based filters.</p><p>I:</p><ul><li>Filter by categories (inclusion/exclusion)</li><li>Filter by date ranges</li><li>Extract full-text content</li><li>Use splitters to tokenize text</li><li>Search by name/content/tags using different matching methods (Begins With, Ends With, AND, OR)</li></ul><p>Despite being a bit slow (½–1s per search), it’s flexible and understandable.</p><h2 id=download-page>Download Page<a hidden class=anchor aria-hidden=true href=#download-page>#</a></h2><p>I use <code>.ashx</code> handlers to control downloads securely. The <code>app_data</code> folder is perfect since IIS blocks direct access.</p><p>Handlers check session login and document ownership. Then they decrypt the file if necessary and stream it back to the user.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>This project taught me a lot about LINQ, secure file storage with <code>app_data</code>, and practical encryption. I now have a working document archive system that I use personally.</p><p>The site is live with 23 MB of PDFs and growing.</p><p>I’m as happy with this as I was with <a href=/posts/2010/mobifinance-loaning-organized/>Mobifinance</a>. The DocsArchive site was previously available <a href=http://docsarchive.mbwarez.dk/>here</a> (link may be broken).</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.mbwarez.dk/tags/c%23/>C#</a></li><li><a href=https://blog.mbwarez.dk/tags/.net/>.NET</a></li><li><a href=https://blog.mbwarez.dk/tags/projects/>Projects</a></li><li><a href=https://blog.mbwarez.dk/tags/utilities/>Utilities</a></li></ul><nav class=paginav><a class=prev href=https://blog.mbwarez.dk/posts/2010/linq-vs-foreach/><span class=title>« Prev</span><br><span>LINQ vs. Foreach</span>
</a><a class=next href=https://blog.mbwarez.dk/posts/2010/bencoding-library/><span class=title>Next »</span><br><span>Bencoding – A C# Library</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share PDF Search Site on x" href="https://x.com/intent/tweet/?text=PDF%20Search%20Site&amp;url=https%3a%2f%2fblog.mbwarez.dk%2fposts%2f2010%2fpdf-search-site%2f&amp;hashtags=C%23%2c.NET%2cProjects%2cUtilities"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PDF Search Site on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.mbwarez.dk%2fposts%2f2010%2fpdf-search-site%2f&amp;title=PDF%20Search%20Site&amp;summary=PDF%20Search%20Site&amp;source=https%3a%2f%2fblog.mbwarez.dk%2fposts%2f2010%2fpdf-search-site%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PDF Search Site on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.mbwarez.dk%2fposts%2f2010%2fpdf-search-site%2f&title=PDF%20Search%20Site"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PDF Search Site on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.mbwarez.dk%2fposts%2f2010%2fpdf-search-site%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PDF Search Site on whatsapp" href="https://api.whatsapp.com/send?text=PDF%20Search%20Site%20-%20https%3a%2f%2fblog.mbwarez.dk%2fposts%2f2010%2fpdf-search-site%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PDF Search Site on telegram" href="https://telegram.me/share/url?text=PDF%20Search%20Site&amp;url=https%3a%2f%2fblog.mbwarez.dk%2fposts%2f2010%2fpdf-search-site%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PDF Search Site on ycombinator" href="https://news.ycombinator.com/submitlink?t=PDF%20Search%20Site&u=https%3a%2f%2fblog.mbwarez.dk%2fposts%2f2010%2fpdf-search-site%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>© <a href=https://github.com/LordMike>Michael Bisbjerg</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>