<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | Thoughts, stories and ideas</title>
<meta name=keywords content><meta name=description content="Posts - Thoughts, stories and ideas"><meta name=author content="Michael Bisbjerg"><link rel=canonical href=https://blog.mbwarez.dk/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.36ab24e4c1b924360adfc391166b0e8914323d9d6ffa42a50f9c6c435c5e1831.css integrity="sha256-Nqsk5MG5JDYK38ORFmsOiRQyPZ1v+kKlD5xsQ1xeGDE=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.mbwarez.dk/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.mbwarez.dk/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.mbwarez.dk/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.mbwarez.dk/apple-touch-icon.png><link rel=mask-icon href=https://blog.mbwarez.dk/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://blog.mbwarez.dk/posts/index.xml><link rel=alternate hreflang=en href=https://blog.mbwarez.dk/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.mbwarez.dk/posts/"><meta property="og:site_name" content="Thoughts, stories and ideas"><meta property="og:title" content="Posts"><meta property="og:description" content="Michael Bisbjergs blog"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://blog.mbwarez.dk/assets/images/cover.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.mbwarez.dk/assets/images/cover.jpg"><meta name=twitter:title content="Posts"><meta name=twitter:description content="Michael Bisbjergs blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.mbwarez.dk/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.mbwarez.dk/ accesskey=h title="Thoughts, stories and ideas (Alt + H)">Thoughts, stories and ideas</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.mbwarez.dk/archives title="All posts"><span>All posts</span></a></li><li><a href=https://blog.mbwarez.dk/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.mbwarez.dk/tags title=Tags><span>Tags</span></a></li><li><a href=https://github.com/LordMike/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/michael-bisbjerg/ title=LinkedIn><span>LinkedIn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://blog.mbwarez.dk/>Home</a></div><h1>Posts
<a href=/posts/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class=post-entry><figure class=entry-cover><img loading=lazy srcset='https://blog.mbwarez.dk/posts/2025/05/esphome-sequential-updates/image_hu_68ad0e87b4500c8d.png 360w,https://blog.mbwarez.dk/posts/2025/05/esphome-sequential-updates/image_hu_a1e625feb86097da.png 480w,https://blog.mbwarez.dk/posts/2025/05/esphome-sequential-updates/image.png 624w' src=https://blog.mbwarez.dk/posts/2025/05/esphome-sequential-updates/image.png sizes="(min-width: 768px) 720px, 100vw" width=624 height=322 alt></figure><header class=entry-header><h2 class=entry-hint-parent>Updating ESPHome Devices Sequentially with Home Assistant Scripts</h2></header><div class=entry-content><p>Why I Needed Sequential Updates I maintain 20‑plus ESPHome nodes on a small ARM‑based Home Assistant server. Each OTA update forces a full C++ compile, which can take ≈ 5 min per device. Two compiles at once, however, balloon the total wall‑time (CPU contention + I/O) and can push the server to its limits.
I opened esphome/feature‑requests #2171 asking for a shared build‑cache across devices—because most of my YAML files differ only in pin mappings. If the cache wasn’t per device, maybe I could have kicked off all devices at once, or even used esphomes own “update all” as it had its own issues with not being able to run for hours and hours. Until that feature lands, the workaround has been to update devices strictly one after another.
...</p></div><footer class=entry-footer><span title='2025-05-12 00:00:00 +0000 UTC'>May 12, 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Michael Bisbjerg</footer><a class=entry-link aria-label="post link to Updating ESPHome Devices Sequentially with Home Assistant Scripts" href=https://blog.mbwarez.dk/posts/2025/05/esphome-sequential-updates/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Smart Refresh Schedule for Sensors in Home Assistant</h2></header><div class=entry-content><p>Polling a sensor at a fixed interval — say, every 5 minutes — is simple to set up. But in practice, it can be wasteful or inadequate: polling too often wastes bandwidth and may hit rate limits, while polling too slowly can leave your data stale when you need it most.
Ideally, we’d poll frequently when someone might be watching, and rarely (or not at all) when the house is asleep or empty. That means dynamic polling based on context.
...</p></div><footer class=entry-footer><span title='2025-05-09 00:00:00 +0000 UTC'>May 9, 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Michael Bisbjerg</footer><a class=entry-link aria-label="post link to Smart Refresh Schedule for Sensors in Home Assistant" href=https://blog.mbwarez.dk/posts/2025/05/ha-smart-poll/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Using dmsetup to Salvage Disks with Bad Blocks</h2></header><div class=entry-content><p>Introduction I have a disk with bad blocks. The filesystem I’m using (such as ZFS) doesn’t support marking bad blocks like ext did, and completely replacing the disk is costly and unnecessary. Instead, I’ve used dmsetup to create a virtual disk that excludes the bad sectors, allowing the filesystem to work with the remaining good areas.
This guide covers the process of scanning the disk, preparing a custom partition, setting up dmsetup, and ensuring everything works across reboots. I’ve additionally included steps to ensure that the dmsetup configuration follows the disk, ensuring you don’t loose that critical piece of information.
...</p></div><footer class=entry-footer><span title='2025-04-07 00:00:00 +0000 UTC'>April 7, 2025</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Michael Bisbjerg</footer><a class=entry-link aria-label="post link to Using dmsetup to Salvage Disks with Bad Blocks" href=https://blog.mbwarez.dk/posts/2025/04/bad-disks-dmsetup/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>WLED Backup script</h2></header><div class=entry-content><p>ℹ️ Info: This post was linked in the WLED discussions and the script may make it to the WLED project.
Introduction WLED is a powerful open-source solution for controlling addressable LEDs over Wi-Fi, making it popular for DIY smart lighting projects. However, maintaining backups of your WLED configurations can be tedious, especially when managing multiple devices.
In this post, I’ll demonstrate a simple bash-based backup solution that discovers WLED devices on your network, pulls their configurations, and saves them locally for easy restoration. The scripts are intended for Linux-based systems and can be scheduled with cron for fully automated backups.
...</p></div><footer class=entry-footer><span title='2025-03-28 00:00:00 +0000 UTC'>March 28, 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Michael Bisbjerg</footer><a class=entry-link aria-label="post link to WLED Backup script" href=https://blog.mbwarez.dk/posts/2025/03/wled-backup-script/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Entity Framework Core: Querying views, but manipulating tables</h2></header><div class=entry-content><p>I had a use case for EF Core where I wanted to query a database view while still supporting classic add/update/delete methods on the base table. Specifically, I wanted to enrich entities with computed values, like a lookup or label, but allow full CRUD support.
Example Problem Suppose we have two entities:
Entity: (Id, DeviceId) Friendly: (DeviceId, FriendlyName) The goal is to filter Entity records by FriendlyName, even though it’s not part of the table directly.
...</p></div><footer class=entry-footer><span title='2023-06-08 16:43:12 +0000 UTC'>June 8, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Michael Bisbjerg</footer><a class=entry-link aria-label="post link to Entity Framework Core: Querying views, but manipulating tables" href=https://blog.mbwarez.dk/posts/2023/entity-framework-core-querying-views-manipulating-tables/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://blog.mbwarez.dk/posts/page/2/>Next&nbsp;2/6&nbsp;»</a></nav></footer></main><footer class=footer><span>© <a href=https://github.com/LordMike>Michael Bisbjerg</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>